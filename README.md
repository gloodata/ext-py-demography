# Gloodata Demography Python Extension


A sample Python extension for [Gloodata](https://gloodata.com/) that displays fertility and demographic data from [Our World in Data: Population & Demography Data Explorer](https://ourworldindata.org/explorers/population-and-demography).

## Getting Started

### Running the Extension

To start the extension, use the following command:

```sh
uv run demography.py --port 8889
```

Alternatively, if you have [just](https://github.com/casey/just) installed, you can use:

```sh
just run
```

### File Structure

- **`demography.py`**: Main extension code.
- **`queries.py`**: Contains the query logic for retrieving data.
- **`glootil.py`**: Utility functions (planned to become a library in the future).
- **`datawrangler.py`**: Script for merging `demography-*.csv` files into `demography.parquet`. You can view usage options with:
  
  ```sh
  uv run datawrangler.py -h
  ```
  
  The Parquet file is already provided in the repository, so running this script is optional.

## Dependencies

The project relies on the following dependencies:

- [uv](https://docs.astral.sh/uv/) - Utility runner for managing scripts.
- [duckdb](https://duckdb.org/docs/api/python/overview.html) - Database engine for data processing.
- [fastapi](https://fastapi.tiangolo.com/) - Web framework for building APIs.
- [pydantic](https://docs.pydantic.dev/latest/) - Data validation and settings management using Python type annotations.
- [uvicorn](https://www.uvicorn.org/) - ASGI server for running FastAPI applications.

## Data Sources

- **`countries.csv`**: Contains country and regional codes, sourced from [github.com/lukes/ISO-3166-Countries-with-Regional-Codes](https://github.com/lukes/ISO-3166-Countries-with-Regional-Codes/blob/master/all/all.csv).

- **`demography-both.csv`**, **`demography-male.csv`**, **`demography-female.csv`**, **`fertility-rate.csv`**: Demographic data from [Our World in Data: Population & Demography Data Explorer](https://ourworldindata.org/explorers/population-and-demography).

- **`demography.parquet`**: Generated by merging the CSV files using `datawrangler.py`. For more details on generating the Parquet file, refer to the `demography-to-parquet` target in `justfile` or run:
  
  ```sh
  uv run datawrangler.py merge-demography-csvs -h
  ```

## Contributing

Feel free to explore, suggest improvements, or contribute to the project. Feedback and contributions are always welcome!

## License

This project is licensed under the [MIT License](https://github.com/gloodata/ext-py-demography/blob/main/LICENSE).

